# Android App Build-Anleitung

Diese Anleitung beschreibt, wie du aus diesem Projekt eine Android APK baust.

## Voraussetzungen

- Node.js und npm installiert
- Bubblewrap CLI (bereits im Projekt als dev dependency installiert)

## Erstmaliges Setup (bereits erledigt)

Diese Schritte wurden bereits durchgeführt und müssen nicht wiederholt werden:

```bash
npm init -y
npm install @bubblewrap/cli --save-dev
npx bubblewrap init --manifest=https://s540d.github.io/kleines-langweiliges-Testprojekt/manifest.json
```

Bei der Initialisierung wurden folgende Optionen gewählt:
- JDK installieren: `Y`
- Android SDK installieren: `Y`
- Android SDK Terms akzeptieren: `y`

## APK bauen (für neue Releases)

### 1. PWA online aktualisieren

Stelle sicher, dass die neueste Version deiner PWA auf GitHub Pages deployed ist:

```bash
git add .
git commit -m "Release v1.x.x"
git push origin main
```

### 2. APK bauen

```bash
cd /Users/svenstrohkark/Documents/Programmierung/Projects/kleines-langweiliges-Testprojekt
npx bubblewrap build
```

### 3. Interaktive Eingaben

Während des Builds wirst du nach folgendem gefragt:

1. **Android SDK Lizenz akzeptieren:**
   ```
   Accept? (y/N): y
   ```

2. **Keystore-Passwort eingeben:**
   - Beim ersten Build: Passwort festlegen und merken!
   - Bei weiteren Builds: Dasselbe Passwort wie beim ersten Mal verwenden

   ```
   Password for the Key Store: [dein-passwort]
   Password for the Key: [dein-passwort]
   ```

### 4. Fertige APK

Nach erfolgreichem Build findest du die APK hier:

```
app-release-signed.apk
```

## APK auf Android-Gerät installieren

### Option A: USB-Kabel

1. APK auf Gerät kopieren
2. Auf dem Gerät: Einstellungen → Sicherheit → "Unbekannte Quellen" aktivieren
3. Datei-Manager öffnen und APK antippen
4. Installation bestätigen

### Option B: ADB (Android Debug Bridge)

```bash
adb install app-release-signed.apk
```

### Option C: Cloud-Transfer

1. APK in Cloud hochladen (Google Drive, Dropbox, etc.)
2. Auf Android-Gerät herunterladen
3. Installieren wie bei Option A

## APK auf Google Play Store hochladen

Für den Play Store benötigst du ein **AAB (Android App Bundle)** statt einer APK:

```bash
npx bubblewrap build --skipSigning
```

Dann:
1. Google Play Console öffnen: https://play.google.com/console
2. App erstellen
3. AAB hochladen
4. Store-Listing ausfüllen (Screenshots, Beschreibung, etc.)
5. App zur Review einreichen

## Versionsnummer erhöhen

Für neue Releases die Version in `twa-manifest.json` erhöhen:

```json
{
  "appVersionName": "1.0.1",
  "appVersionCode": 2
}
```

**Wichtig:**
- `appVersionCode` muss bei jedem Release hochgezählt werden (Integer)
- `appVersionName` ist die sichtbare Version (z.B. "1.0.1")

## Troubleshooting

### Build schlägt fehl: "License not accepted"

```bash
npx bubblewrap build
# Bei "Accept? (y/N):" → y eingeben
```

### Build schlägt fehl: "Wrong keystore password"

Du hast das falsche Keystore-Passwort eingegeben. Verwende das Passwort vom ersten Build.

Falls vergessen: Neuen Keystore erstellen (aber alte APKs können nicht mehr aktualisiert werden):

```bash
rm android.keystore
npx bubblewrap build
```

### PWA-Änderungen nicht in der App sichtbar

Die App lädt die PWA von der URL. Stelle sicher, dass:
1. Änderungen auf GitHub Pages deployed sind
2. Service Worker aktualisiert wurde
3. Cache auf dem Gerät gelöscht wurde (App-Daten löschen)

## Wichtige Dateien

- `twa-manifest.json` - TWA-Konfiguration (Package-ID, URLs, etc.)
- `android.keystore` - Signing-Key (NICHT committen! In .gitignore)
- `app-release-signed.apk` - Fertige APK (NICHT committen!)

## Sicherheit

⚠️ **WICHTIG:** Füge folgendes zu `.gitignore` hinzu:

```
android.keystore
*.apk
*.aab
app/
```

Das Keystore-Passwort NIEMALS ins Repository committen!
